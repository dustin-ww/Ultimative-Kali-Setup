---
# tasks file for tmux role

- name: Install tmux package
  ansible.builtin.package:
    name: tmux
    state: present
  become: true

- name: Ensure .tmux.conf is deployed from template
  ansible.builtin.template:
    src: tmux.conf.j2
    dest: "{{ ansible_user_dir }}/.tmux.conf"
    owner: "{{ ansible_user_id }}"
    group: "{{ ansible_user_gid }}"
    mode: '0644'
    backup: yes

- name: Check if tmux server is running
  ansible.builtin.shell: tmux list-sessions 2>/dev/null
  register: tmux_running
  failed_when: false
  changed_when: false

- name: Reload tmux configuration if server is running
  ansible.builtin.shell: tmux source-file {{ ansible_user_dir }}/.tmux.conf
  when: tmux_running.rc == 0
  changed_when: true

- name: Display tmux installation info
  ansible.builtin.debug:
    msg: "tmux configuration has been deployed to {{ ansible_user_dir }}/.tmux.conf"